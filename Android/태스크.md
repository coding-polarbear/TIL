# 태스크
* 액티비티 작업 묶음 단위
* 앱가 태스크는 1대 1로 대응하는 것이 아님.
* 여러 개의 앱이 하나의 태스크가 될 수도 있고, 필요하면 하나의 앱에서도 태스크를 여러 개 가질 수 있음.

### 백스택
* 액티비티는 백스택 (`backstack`) 이라고 불리는 스택에 차례대로 쌓임.
* 태스크 : 액티비티의 모임
* 백스택 : 그 모임이 저장된 방식
* 스택은 말 그대로 LIFO(`Last-In-First-Out`) 방식으로 쌓이고 사라짐
* 개발자 가이드에는 백 스택이 스택구조라서 넣고 빼기만 할 수 있고 순서를 바꿀 수 없다고 나옴
* 그러나 `Intent.FLAG_ACTIVITY_REORDER_TO_FRONT` 플래그를 사용하면 순서를 조정할 수도 있음.

### 태스크 관리 필요
* 단순하게 `startActivity()`를 실행해서 스택에 추가하고 백 키로 제거해가면 아무 일도 없지만, 실제 앱에서는 다양한 경로로 액티비티를 접근하기 때문에 내비게이션이 꼬이는 경우가 많음.
* 이때문에 태스크의 관리가 필요함.
* 각 앱에서 원하는 내비게이션이 있는데, 태스크의 동작 방식을 이해하지 못하면 사용자가 보려는 화면이 아닌 엉뚱한 화면을 보여주는 경우가 생김
* 태스크의 동작 방식은 이해하기 쉽지 않고 이 때문에 많은 시행착오를 겪을 수 있음.

## 태스크 상태
* 태스크는 화면에 포커스되어 있는 `foreground` 상태와 화면에 보이지 않는 `background` 상태가 있음.
* 앱 아이콘, 숏컷, 앱 위젯, 노티피케이션을 통해 새로운 `foreground 태스크`가 될 수 있음
* `foreground`에 있는 것은 언제든 홈키를 통해 백그라운드로 이동할 수 있음.

### 포그라운드에서 백그라운드로 태스크 이동
* 포그라운드에서 백그라운드로 상태를 변경하는 메소드는 Activity의 `moveTaskBack(boolean nonRoot)`
* `nonRoot`에 `true`가 들어가면 어느 위치에서건 백그라운드로 이동할 수 있음.
* `false`인 경우에는 태스크 루트일 때만 백그라운드로 이동이 가능함.
* 주로 패스워드 입력 창 등에서 사용됨.


### 백그라운드에서 포그라운드로 태스크 이동
* `ActivityManager`의 `moveTaskToFront(int taskId, int flags)` 메소드를 사용하면 됨.
* 허니콤부터 사용 가능하고, `android.permissions.REORDER_TASKS` 퍼미션이 필요함.


## dumpsys 명령어로 태스크 확인
* 화면이 바뀌는 것을 눈으로 직접 보면서 테스트하면 태스크가 정상적으로 동작하는지 확인하기가 어려움.
* 백 키로 전환하는 화면들은 마치 하나의 스택처럼 보이는데, 이 화면들이 동일한 태스크라고 확신할 수 없음.
* 태스크를 확인할 때에는 adb shell에서 dumpsys 명령어를 활용함.
* `adb shell dumpsys activity activities`를 실행하거나, adb shell 내에서 `dumpsys activity activities`를 실행하면 됨.

### dumpsys 명령어로 포커스된 액티비티 찾기
* dumpsys 명령어는 개발중에 혅 ㅐ포커스된 액티비티가 어떤 것인지 확인하는 데도 유용함.
* 테스트하면서 여러 액티비티를 이동하다 보면 현재 어느 액티비티에 있는지 찾는게 간단하지 않다는 것을 알게 됨.
* `adb shell dumpsys activity a | grep mFocusedActivity`